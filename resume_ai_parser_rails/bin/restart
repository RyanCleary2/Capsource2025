#!/usr/bin/env bash

# Kill any existing Rails server
if [ -f tmp/pids/server.pid ]; then
  pid=$(cat tmp/pids/server.pid)
  if ps -p $pid > /dev/null 2>&1; then
    echo "Killing existing Rails server (PID: $pid)..."
    kill $pid
    sleep 2
  fi
  rm -f tmp/pids/server.pid
fi

# Also kill any process running on port 3000 (default Rails port)
echo "Checking for processes on port 3000..."
lsof -ti:3000 | xargs -r kill -9 2>/dev/null

echo "Starting Rails server..."
exec ./bin/rails server "$@"