<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CapSource AI Case Generator</title>
  <%= stylesheet_link_tag 'application', media: 'all' %>
  <%= javascript_importmap_tags %>
  <style>
    /* All styles remain unchanged */
  </style>
</head>
<body>
  <header>
    <div class="container header-container">
      <div style="display: flex; align-items: center;">
        <div class="logo">
          <%= image_tag 'logo.png', alt: 'CapSource Logo', height: '40' %>
          <h1>CapSource</h1>
        </div>
        <nav>
          <ul class="nav-links">
            <li><a href="#">EDUCATORS</a></li>
            <li><a href="#">STUDENTS</a></li>
            <li><a href="#">ORGANIZATIONS</a></li>
            <li><a href="#">OPPORTUNITIES</a></li>
            <li><a href="#">LEARN MORE</a></li>
          </ul>
        </nav>
      </div>
      <div class="auth-buttons">
        <a href="#" class="btn btn-outline">LOGIN</a>
        <a href="#" class="btn btn-primary">REGISTER</a>
      </div>
    </div>
  </header>

  <section class="hero">
    <div class="container hero-content">
      <h1>AI-Powered Case Generator</h1>
      <p>Create industry-relevant cases for students with AI assistance. Choose to generate a full case scope or explore case ideas based on topics.</p>
    </div>
  </section>

  <section id="generator" class="case-generator">
    <div class="container">
      <div class="generator-container">
        <div class="generator-heading">
          <h2>Case Generator</h2>
          <p>Fill in the details below to create a customized case or explore case ideas with AI assistance</p>
        </div>

        <%= form_with url: generate_case_path, local: true, id: 'case-form' do |f| %>
          <% if flash.now[:alert] %>
            <div style="color: #e74c3c; background-color: #f9eae9; padding: 15px; border-radius: var(--border-radius); margin-bottom: 20px;">
              <%= flash.now[:alert] %>
            </div>
          <% end %>

          <div class="form-section">
            <h3>Basic Information</h3>
            <div class="form-grid">
              <div class="form-group">
                <%= f.label :website_url, 'Website URL' %>
                <%= f.url_field :website_url, placeholder: 'Enter your company website URL', required: true %>
              </div>
              <div class="form-group">
                <%= f.label :case_owner, 'Case Owner' %> <span class="optional-label">(optional)</span>
                <%= f.text_field :case_owner, placeholder: 'Enter case owner\'s name' %>
              </div>
            </div>
          </div>

          <div class="form-section">
            <h3>Generation Mode</h3>
            <div class="generation-mode">
              <label>
                <%= f.check_box :mode, { checked: false, id: 'mode-checkbox' }, 'true', 'false' %>
                Generate Case Ideas (instead of full scope)
              </label>
              <p>Generate a list of case ideas based on selected topics, or create a detailed case scope with milestones and deliverables.</p>
            </div>
          </div>

          <div class="form-section" id="background-group">
            <h3>Case Details</h3>
            <div class="form-group">
              <%= f.label :background, 'Goal Statement' %>
              <%= f.text_area :background, placeholder: 'Describe the goal of the case (e.g., "Develop a marketing strategy for a new product launch")', required: true %>
            </div>

            <div class="form-grid">
              <div class="form-group">
                <%= f.label :industry, 'Industry' %> <span class="optional-label">(optional but recommended)</span>
                <%= f.select :industry, [['Select an industry', ''], 'Technology', 'Healthcare', 'Finance', 'Education', 'Retail', 'Manufacturing', 'Non-profit'] %>
              </div>
              <div class="form-group">
                <%= f.label :case_type, 'Case Type' %> <span class="optional-label">(optional but recommended)</span>
                <%= f.select :case_type, [['Select case type', ''], 'Case Study', 'Live Case', 'Research Case', 'Internship', 'Competition'] %>
              </div>
            </div>
          </div>

          <div class="form-section hidden" id="topics-group">
            <h3>Case Topics</h3>
            <div class="form-group">
              <%= f.label :topics, 'Select Topics' %> <span class="optional-label">(select at least one)</span>
              <div class="topics-checkboxes">
                <label><input type="checkbox" name="topics[]" value="technology-commercialization"> Technology Commercialization</label>
                <label><input type="checkbox" name="topics[]" value="innovation"> Innovation</label>
                <label><input type="checkbox" name="topics[]" value="training-development"> Training & Development</label>
                <label><input type="checkbox" name="topics[]" value="inventory-management"> Inventory Management</label>
                <label><input type="checkbox" name="topics[]" value="electrical-engineering"> Electrical Engineering</label>
                <label><input type="checkbox" name="topics[]" value="mechanical-engineering"> Mechanical Engineering</label>
                <label><input type="checkbox" name="topics[]" value="market-research"> Market Research</label>
                <label><input type="checkbox" name="topics[]" value="digital-marketing"> Digital Marketing</label>
                <label><input type="checkbox" name="topics[]" value="information-technology"> Information Technology (IT)</label>
                <label><input type="checkbox" name="topics[]" value="pr-communications"> PR & Communications</label>
                <label><input type="checkbox" name="topics[]" value="employee-labor-management"> Employee and Labor Management</label>
                <label><input type="checkbox" name="topics[]" value="entrepreneurship"> Entrepreneurship</label>
                <label><input type="checkbox" name="topics[]" value="child-online-safety"> Child Online Safety</label>
                <label><input type="checkbox" name="topics[]" value="cybersecurity"> Cybersecurity</label>
                <label><input type="checkbox" name="topics[]" value="civil-engineering"> Civil Engineering</label>
                <label><input type="checkbox" name="topics[]" value="child-welfare"> Child Welfare</label>
                <label><input type="checkbox" name="topics[]" value="urban-planning"> Urban Planning</label>
                <label><input type="checkbox" name="topics[]" value="research-analysis-evaluation"> Research, Analysis, Evaluation</label>
                <label><input type="checkbox" name="topics[]" value="public-administration"> Public Administration</label>
                <label><input type="checkbox" name="topics[]" value="political-organization"> Political Organization, Policy Change, and Advocacy</label>
                <label><input type="checkbox" name="topics[]" value="individual-family-advocacy"> Individual and Family Advocacy</label>
                <label><input type="checkbox" name="topics[]" value="facilitation-mediation"> Facilitation, Mediation, Conflict Resolution</label>
                <label><input type="checkbox" name="topics[]" value="economic-development"> Economic Development, Work and Occupations</label>
                <label><input type="checkbox" name="topics[]" value="crisis-disaster-management"> Crisis and Disaster Management</label>
                <label><input type="checkbox" name="topics[]" value="courts-corrections"> Courts, Corrections, and Law Enforcement</label>
                <label><input type="checkbox" name="topics[]" value="community-organization"> Community Organization and Social Action</label>
                <label><input type="checkbox" name="topics[]" value="case-management"> Case Management</label>
                <label><input type="checkbox" name="topics[]" value="substance-use"> Substance Use, Addiction, and Recovery</label>
                <label><input type="checkbox" name="topics[]" value="international-affairs"> International Affairs</label>
                <label><input type="checkbox" name="topics[]" value="reporting-financial-planning"> Reporting, Financial Planning & Analysis</label>
                <label><input type="checkbox" name="topics[]" value="talent-management"> Talent Management</label>
                <label><input type="checkbox" name="topics[]" value="software-design-development"> Software Design & Development</label>
                <label><input type="checkbox" name="topics[]" value="sales-business-development"> Sales & Business Development</label>
                <label><input type="checkbox" name="topics[]" value="research-development"> Research & Development</label>
                <label><input type="checkbox" name="topics[]" value="quality-control"> Quality Control</label>
                <label><input type="checkbox" name="topics[]" value="purchasing-logistics"> Purchasing, Logistics, Supply Chain</label>
                <label><input type="checkbox" name="topics[]" value="product-design-development"> Product Design & Development</label>
                <label><input type="checkbox" name="topics[]" value="organizational-culture"> Organizational Culture</label>
                <label><input type="checkbox" name="topics[]" value="operations"> Operations</label>
                <label><input type="checkbox" name="topics[]" value="mergers-acquisitions"> Mergers & Acquisitions</label>
                <label><input type="checkbox" name="topics[]" value="marketing"> Marketing</label>
                <label><input type="checkbox" name="topics[]" value="legal-regulatory"> Legal, Regulatory, Compliance</label>
                <label><input type="checkbox" name="topics[]" value="growth-strategy"> Growth Strategy</label>
                <label><input type="checkbox" name="topics[]" value="data-management"> Data Management</label>
                <label><input type="checkbox" name="topics[]" value="customer-service"> Customer Service & Account Management</label>
                <label><input type="checkbox" name="topics[]" value="corporate-social-responsibility"> Corporate Social Responsibility</label>
              </div>
              <div class="error-message" id="topics-error">Please select at least one topic for case ideas</div>
            </div>
          </div>

          <div class="form-footer">
            <%= f.submit 'Generate Case Scope', class: 'generate-btn', id: 'generate-btn' %>
          </div>
        <% end %>
      </div>
    </div>
  </section>

  <footer>
    <div class="container footer-container">
      <div>© 2025 CapSource. All rights reserved.</div>
      <div class="footer-links">
        <a href="#">Privacy Policy</a>
        <a href="#">Terms of Service</a>
        <a href="#">Contact Us</a>
      </div>
    </div>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // DOM Elements
      const modeCheckbox = document.getElementById('mode-checkbox');
      const backgroundGroup = document.getElementById('background-group');
      const topicsGroup = document.getElementById('topics-group');
      const generateButton = document.getElementById('generate-btn');
      const form = document.getElementById('case-form');
      const topicsError = document.getElementById('topics-error');

      // Debugging: Check if elements are found
      console.log('Mode Checkbox:', modeCheckbox);
      console.log('Background Group:', backgroundGroup);
      console.log('Topics Group:', topicsGroup);
      console.log('Generate Button:', generateButton);
      console.log('Form:', form);

      // Ensure all elements exist
      if (!modeCheckbox || !backgroundGroup || !topicsGroup || !generateButton || !form || !topicsError) {
        console.error('One or more DOM elements not found.');
        return;
      }

      // Function to toggle visibility of sections
      function toggleFormSections() {
        const isIdeasMode = modeCheckbox.checked;
        console.log('Ideas Mode:', isIdeasMode);

        if (isIdeasMode) {
          backgroundGroup.classList.add('hidden');
          topicsGroup.classList.remove('hidden');
          generateButton.value = 'Generate Case Ideas';
          // Remove required attribute from goal statement field in ideas mode
          const goalField = document.querySelector('textarea[name="background"]');
          if (goalField) goalField.removeAttribute('required');
        } else {
          backgroundGroup.classList.remove('hidden');
          topicsGroup.classList.add('hidden');
          generateButton.value = 'Generate Case Scope';
          // Restore required attribute for goal statement field in scope mode
          const goalField = document.querySelector('textarea[name="background"]');
          if (goalField) goalField.setAttribute('required', '');
        }
      }

      // Set initial state
      toggleFormSections();

      // Add event listener for checkbox changes
      modeCheckbox.addEventListener('change', toggleFormSections);

      // Form submission validation for topics
      form.addEventListener('submit', function(event) {
        if (modeCheckbox.checked) {
          const selectedTopics = document.querySelectorAll('input[name="topics[]"]:checked');
          if (selectedTopics.length === 0) {
            event.preventDefault();
            topicsError.style.display = 'block';
            topicsGroup.scrollIntoView({ behavior: 'smooth' });
          } else {
            topicsError.style.display = 'none';
          }
        } else {
          topicsError.style.display = 'none';
        }
      });
    });
  </script>
</body>
</html>
